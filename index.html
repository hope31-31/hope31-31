<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Class Chat Live</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  html, body { margin:0; padding:0; height:100%; font-family:"Georgia", sans-serif; background:#1e1b2d; color:#dcd6f7; display:flex; }
  #sidebar { width:260px; background:#2b2244; padding:10px; display:flex; flex-direction:column; box-sizing:border-box; }
  #main { flex:1; display:flex; flex-direction:column; }
  #chat { flex:1; overflow-y:auto; padding:10px; scrollbar-width: thin; scrollbar-color:#7fa1ff #2b2244; }
  #chat::-webkit-scrollbar { width:6px; }
  #chat::-webkit-scrollbar-thumb { background-color:#7fa1ff; border-radius:4px; }
  .msg { margin-bottom:10px; padding:8px 12px; border-radius:6px; max-width:85%; word-wrap:break-word; background:#3a2e66; color:#e0d9ff; }
  .me { background:#5a7fff; margin-left:auto; text-align:right; color:#fff; }
  .meta { font-size:0.75rem; opacity:0.7; margin-bottom:2px; }
  .text { font-size:1rem; }
  #form { display:flex; padding:10px; background:#4b3b77; gap:6px; }
  #message { flex:1; padding:10px; border-radius:4px; border:1px solid #6658a8; background:#2b2244; color:#e0d9ff; font-size:1rem; }
  #send { padding:10px; border:none; border-radius:4px; background:#7fa1ff; color:#111b33; font-weight:bold; cursor:pointer; }
  #send:disabled { opacity:0.5; cursor:default; }
  .sidebar-section { margin-bottom:15px; }
  .user-avatar { width:40px; height:40px; border-radius:50%; background:#7fa1ff; display:inline-block; margin-right:8px; vertical-align:middle; }
  .typing { font-style:italic; opacity:0.7; margin-bottom:4px; }
  select, input, button { font-size:1rem; padding:6px; border-radius:4px; border:none; }
  button { cursor:pointer; }
</style>
</head>
<body>

<div id="sidebar">
  <div class="sidebar-section">
    <div class="user-avatar" id="myAvatar"></div>
    <input type="text" id="username" placeholder="Your name">
  </div>

  <div class="sidebar-section">
    <label>Room:</label>
    <select id="roomSelect">
      <option value="general">General</option>
    </select>
    <button id="createRoomBtn">Create Room</button>
  </div>

  <div class="sidebar-section">
    <button id="muteBtn">Mute</button>
    <button id="kickBtn">Kick User</button>
  </div>

  <div class="sidebar-section">
    <button id="inviteBtn">Invite Friend</button>
  </div>

  <div class="sidebar-section">
    <strong>Online Users:</strong>
    <ul id="onlineUsers" style="list-style:none;padding-left:0;"></ul>
  </div>
</div>

<div id="main">
  <div id="chat"></div>
  <div class="typing" id="typingIndicator" style="display:none;">Someone is typing...</div>
  <form id="form">
    <input id="message" placeholder="Type a message...">
    <button id="send" type="submit">Send</button>
  </form>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  // ðŸ”¥ Your Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MSG_ID",
    appId: "YOUR_APP_ID",
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const chatEl = document.getElementById("chat");
  const formEl = document.getElementById("form");
  const msgInput = document.getElementById("message");
  const userInput = document.getElementById("username");
  const muteBtn = document.getElementById("muteBtn");
  const kickBtn = document.getElementById("kickBtn");
  const roomSelect = document.getElementById("roomSelect");
  const createRoomBtn = document.getElementById("createRoomBtn");
  const inviteBtn = document.getElementById("inviteBtn");
  const onlineUsersEl = document.getElementById("onlineUsers");
  const typingIndicator = document.getElementById("typingIndicator");

  let currentRoom = "general";
  let muted = false;
  let username = "";
  let typingTimeout;

  // Add message to UI
  function addMessage(msg, isMe){
    const wrap = document.createElement("div");
    wrap.className = "msg" + (isMe ? " me" : "");
    const meta = document.createElement("div");
    meta.className = "meta";
    meta.textContent = msg.name + " â€¢ " + new Date(msg.time).toLocaleTimeString();
    const text = document.createElement("div");
    text.className = "text";
    text.textContent = msg.text;
    wrap.appendChild(meta);
    wrap.appendChild(text);
    chatEl.appendChild(wrap);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  // Track online users
  const onlineUsersRef = db.collection("onlineUsers");
  function updateOnlineUsers() {
    onlineUsersRef.get().then(snapshot => {
      onlineUsersEl.innerHTML = "";
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = doc.data().name;
        onlineUsersEl.appendChild(li);
      });
    });
  }

  // Join room
  function joinRoom(room) {
    currentRoom = room;
    chatEl.innerHTML = "";
    listenMessages();
  }

  function listenMessages() {
    db.collection("messages").where("room", "==", currentRoom).orderBy("time")
      .onSnapshot(snapshot=>{
        chatEl.innerHTML = "";
        snapshot.forEach(doc=>{
          const msg = doc.data();
          addMessage(msg, msg.name === username);
        });
      });
  }

  // Sending messages
  formEl.addEventListener("submit", e=>{
    e.preventDefault();
    if(muted) return;
    const text = msgInput.value.trim();
    if(!text) return;
    db.collection("messages").add({name:username||"anon", text, time:Date.now(), room:currentRoom});
    msgInput.value="";
  });

  // Typing indicator
  msgInput.addEventListener("input", ()=>{
    db.collection("typing").doc(currentRoom).set({typing:true, user:username});
    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(()=>db.collection("typing").doc(currentRoom).set({typing:false}), 1000);
  });

  db.collection("typing").doc(currentRoom)
    .onSnapshot(doc=>{
      if(doc.exists && doc.data().typing && doc.data().user !== username) {
        typingIndicator.style.display = "block";
      } else {
        typingIndicator.style.display = "none";
      }
    });

  // Mute/unmute
  muteBtn.addEventListener("click", ()=>{ muted = !muted; muteBtn.textContent = muted ? "Unmute" : "Mute"; });

  // Kick user (password "slay")
  kickBtn.addEventListener("click", ()=>{
    const pass = prompt("Enter kick password:");
    if(pass !== "slay") return alert("Wrong password");
    const kickedUser = prompt("Enter username to kick:");
    alert(kickedUser + " was kicked from this room (local only)");
  });

  // Create new private room
  createRoomBtn.addEventListener("click", ()=>{
    const roomName = prompt("Enter private room name:");
    if(!roomName) return;
    const pass = prompt("Enter password for this private room:");
    roomSelect.innerHTML += `<option value="${roomName}">${roomName}</option>`;
    roomSelect.value = roomName;
    joinRoom(roomName);
  });

  // Room switch
  roomSelect.addEventListener("change", ()=>joinRoom(roomSelect.value));

  // Invite friend
  inviteBtn.addEventListener("click", ()=>{
    const friendName = prompt("Enter your friend's username to invite:");
    alert("Invite sent to " + friendName + " (notification system not implemented yet)");
  });

  // Set username and join online users
  userInput.addEventListener("change", ()=>{
    username = userInput.value.trim()||"anon";
    onlineUsersRef.doc(username).set({name:username});
    updateOnlineUsers();
  });

  // Initialize
  joinRoom("general");
</script>
</body>
</html>